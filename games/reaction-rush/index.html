<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reaction Rush</title>
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif;
      background:#0b1220; color:#e7eefc;
      display:flex; min-height:100vh; align-items:center; justify-content:center;
    }
    .card{
      width:min(720px, 92vw);
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      padding:22px 18px;
    }
    h1{ margin:0 0 6px; font-size:22px; letter-spacing:.2px; }
    .sub{ opacity:.8; margin:0 0 16px; line-height:1.45; }
    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:14px; }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr; } }
    .panel{
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:14px;
    }
    .bigBtn{
      width:100%;
      padding:18px 14px;
      font-size:18px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:#2a3346;
      color:#e7eefc;
      cursor:pointer;
      transition: transform .04s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .bigBtn:active{ transform: scale(.99); }
    .bigBtn[disabled]{ cursor:not-allowed; opacity:.88; }
    .state-ready{ background:#2a3346; }
    .state-wait{ background:#5a3b2b; border-color: rgba(255,199,153,.35); }
    .state-go{ background:#1f5a3b; border-color: rgba(144,255,192,.35); }
    .state-fail{ background:#5a1f2a; border-color: rgba(255,144,170,.35); }

    .stats{
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
    }
    .stat{
      padding:10px 12px;
      border-radius:12px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
    }
    .k{ opacity:.75; font-size:12px; }
    .v{ font-size:20px; font-weight:700; margin-top:4px; }
    .row{ display:flex; gap:10px; margin-top:12px; }
    .btn{
      flex:1;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#e7eefc;
      cursor:pointer;
    }
    .btn:hover{ background:rgba(255,255,255,.09); }
    .log{
      margin-top:10px;
      max-height:220px;
      overflow:auto;
      font-size:13px;
      line-height:1.45;
      opacity:.9;
    }
    .tag{
      display:inline-block;
      font-size:12px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      margin-left:8px;
      opacity:.9;
    }
    .hint{ opacity:.75; font-size:12px; margin-top:10px; }
    a{ color:#9fd0ff; text-decoration:none; }
    a:hover{ text-decoration:underline; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Reaction Rush <span class="tag">å–®æª”å¯ä¸Š GitHub Pages</span></h1>
    <p class="sub">
      ç­‰æŒ‰éˆ•è®Šç¶ å†é»ï¼Œå¤ªæ—©é»ç®—å¤±æ•—ã€‚10 å±€å¾Œæœƒç®—å¹³å‡ã€‚
      <br/>ï¼ˆé€™æ±è¥¿å¾ˆç„¡èŠæ²’éŒ¯ï¼Œä½†å®ƒå¾ˆã€Œå¯å±•ç¤ºã€ï¼Œè€Œä¸”ä¸æœƒæƒ¹è³‡å®‰éƒ¨é–€ä¸çˆ½ã€‚ï¼‰
    </p>

    <div class="grid">
      <div class="panel">
        <button id="playBtn" class="bigBtn state-ready">é–‹å§‹ï¼ˆæŒ‰æˆ‘ï¼‰</button>
        <div class="hint">
          å¿«æ·éµï¼š<b>Space</b> é–‹å§‹/é»æ“Šã€€|ã€€<b>R</b> é‡ç½®
        </div>
        <div id="log" class="log"></div>
      </div>

      <div class="panel">
        <div class="stats">
          <div class="stat">
            <div class="k">å›åˆ</div>
            <div id="round" class="v">0 / 10</div>
          </div>
          <div class="stat">
            <div class="k">æœ€æ–°åæ‡‰</div>
            <div id="last" class="v">â€”</div>
          </div>
          <div class="stat">
            <div class="k">å¹³å‡ï¼ˆæˆåŠŸï¼‰</div>
            <div id="avg" class="v">â€”</div>
          </div>
          <div class="stat">
            <div class="k">æœ€ä½³</div>
            <div id="best" class="v">â€”</div>
          </div>
        </div>

        <div class="row">
          <button id="resetBtn" class="btn">é‡ç½®</button>
          <button id="copyBtn" class="btn">è¤‡è£½æˆç¸¾</button>
        </div>

        <div class="hint">
          å°æç¤ºï¼šä½ å¦‚æœå¹³å‡ <b>&lt; 220ms</b>ï¼Œé‚£ä½ ä¸æ˜¯å¾ˆå¼·ï¼Œå°±æ˜¯ä½ åœ¨ä½œå¼Šï¼ˆæˆ‘æŒä¿ç•™æ…‹åº¦ï¼‰ã€‚
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const playBtn  = document.getElementById('playBtn');
  const resetBtn = document.getElementById('resetBtn');
  const copyBtn  = document.getElementById('copyBtn');
  const elRound  = document.getElementById('round');
  const elLast   = document.getElementById('last');
  const elAvg    = document.getElementById('avg');
  const elBest   = document.getElementById('best');
  const logEl    = document.getElementById('log');

  const TOTAL = 10;
  let state = 'ready'; // ready | wait | go | done
  let round = 0;
  let results = []; // {ms, ok}
  let tGo = 0;
  let timer = null;

  // Keep best score in localStorage (pure client-side)
  const LS_KEY = 'reaction_rush_best_ms';
  let bestMs = Number(localStorage.getItem(LS_KEY) || 0) || 0;

  function fmtMs(ms){ return `${Math.round(ms)} ms`; }

  function setBtnState(kind){
    playBtn.classList.remove('state-ready','state-wait','state-go','state-fail');
    if(kind==='ready'){
      playBtn.classList.add('state-ready');
      playBtn.textContent = 'é–‹å§‹ï¼ˆæŒ‰æˆ‘ï¼‰';
    }else if(kind==='wait'){
      playBtn.classList.add('state-wait');
      playBtn.textContent = 'ç­‰ä¸€ä¸‹â€¦ï¼ˆåˆ¥å·é»ï¼‰';
    }else if(kind==='go'){
      playBtn.classList.add('state-go');
      playBtn.textContent = 'ç¾åœ¨ï¼é»ï¼';
    }else if(kind==='fail'){
      playBtn.classList.add('state-fail');
      playBtn.textContent = 'å¤ªæ—©äº† ğŸ˜‘ï¼ˆå†ä¾†ï¼‰';
    }else if(kind==='done'){
      playBtn.classList.add('state-ready');
      playBtn.textContent = 'å†ç©ä¸€è¼ª';
    }
  }

  function updateStats(){
    elRound.textContent = `${round} / ${TOTAL}`;

    const last = results.length ? results[results.length-1] : null;
    elLast.textContent = last ? (last.ok ? fmtMs(last.ms) : 'å¤±æ•—') : 'â€”';

    const oks = results.filter(r => r.ok).map(r => r.ms);
    if(oks.length){
      const avg = oks.reduce((a,b)=>a+b,0) / oks.length;
      elAvg.textContent = fmtMs(avg);
      const best = Math.min(...oks);
      elBest.textContent = fmtMs(bestMs ? Math.min(bestMs, best) : best);
    }else{
      elAvg.textContent = 'â€”';
      elBest.textContent = bestMs ? fmtMs(bestMs) : 'â€”';
    }
  }

  function log(line){
    const ts = new Date().toLocaleTimeString();
    logEl.innerHTML = `<div>[${ts}] ${line}</div>` + logEl.innerHTML;
  }

  function clearTimer(){
    if(timer){ clearTimeout(timer); timer = null; }
  }

  function scheduleGo(){
    clearTimer();
    // random delay: 900~2600ms
    const delay = 900 + Math.random() * 1700;
    timer = setTimeout(() => {
      state = 'go';
      tGo = performance.now();
      setBtnState('go');
      log('âœ… GOï¼');
    }, delay);
  }

  function startRound(){
    if(round >= TOTAL){
      // new session
      round = 0;
      results = [];
    }
    round += 1;
    state = 'wait';
    setBtnState('wait');
    playBtn.disabled = false;
    log(`ç¬¬ ${round} å›åˆï¼šç­‰å¾…è®Šç¶ â€¦`);
    scheduleGo();
    updateStats();
  }

  function onClick(){
    if(state === 'ready' || state === 'done'){
      startRound();
      return;
    }
    if(state === 'wait'){
      // early click
      results.push({ms: 0, ok: false});
      setBtnState('fail');
      log('âŒ å¤ªæ—©é»ï¼šåˆ¤å®šå¤±æ•—ã€‚');
      clearTimer();
      state = 'ready';
      updateStats();
      return;
    }
    if(state === 'go'){
      const ms = performance.now() - tGo;
      results.push({ms, ok: true});
      log(`ğŸ¯ å‘½ä¸­ï¼š${fmtMs(ms)}`);

      if(!bestMs || ms < bestMs){
        bestMs = ms;
        localStorage.setItem(LS_KEY, String(Math.round(bestMs)));
        log(`ğŸ† æ–°ç´€éŒ„ï¼š${fmtMs(bestMs)}`);
      }

      updateStats();

      if(round >= TOTAL){
        state = 'done';
        setBtnState('done');
        log('ğŸ“Š æœ¬è¼ªçµæŸã€‚æŒ‰ã€Œå†ç©ä¸€è¼ªã€æˆ– Spaceã€‚');
      }else{
        // auto next
        state = 'ready';
        setBtnState('ready');
        // slight pause then start next to keep flow
        setTimeout(startRound, 450);
      }
    }
  }

  function resetAll(){
    clearTimer();
    state = 'ready';
    round = 0;
    results = [];
    setBtnState('ready');
    log('ğŸ”„ å·²é‡ç½®ï¼ˆä¸å«æœ€ä½³ç´€éŒ„ï¼‰ã€‚');
    updateStats();
  }

  async function copyScore(){
    const oks = results.filter(r => r.ok).map(r => r.ms);
    const fails = results.filter(r => !r.ok).length;
    const avg = oks.length ? (oks.reduce((a,b)=>a+b,0)/oks.length) : null;
    const best = oks.length ? Math.min(...oks) : null;

    const text =
`Reaction Rush æˆç¸¾
- å›åˆï¼š${round}/${TOTAL}
- æˆåŠŸï¼š${oks.length}ï¼Œå¤±æ•—ï¼š${fails}
- å¹³å‡ï¼š${avg ? Math.round(avg)+' ms' : 'â€”'}
- æœ¬è¼ªæœ€ä½³ï¼š${best ? Math.round(best)+' ms' : 'â€”'}
- æ­·å²æœ€ä½³ï¼š${bestMs ? Math.round(bestMs)+' ms' : 'â€”'}
- æ™‚é–“ï¼š${new Date().toLocaleString()}`;

    try{
      await navigator.clipboard.writeText(text);
      log('ğŸ“‹ æˆç¸¾å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ã€‚');
    }catch(e){
      log('âš ï¸ è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨æ¬Šé™å•é¡Œï¼‰ã€‚ä½ å¯ä»¥æ‰‹å‹•é¸å–ã€‚');
      // fallback: prompt
      window.prompt('è¤‡è£½é€™æ®µï¼š', text);
    }
  }

  playBtn.addEventListener('click', onClick);
  resetBtn.addEventListener('click', resetAll);
  copyBtn.addEventListener('click', copyScore);

  window.addEventListener('keydown', (e) => {
    if(e.code === 'Space'){
      e.preventDefault();
      onClick();
    }else if(e.key.toLowerCase() === 'r'){
      resetAll();
    }
  });

  // Init
  setBtnState('ready');
  updateStats();
  log('ğŸ‘‹ Readyã€‚æŒ‰ã€Œé–‹å§‹ã€æˆ– Spaceã€‚');
})();
</script>
</body>
</html>
